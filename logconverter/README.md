# BBSNote → POTI-board ログコンバータ
BBSNote v7またはv8のログファイルをPOTI-boardで使える形式に変換します。  
relmのログもPOTI-board形式に変換します。

## 免責
正常に動作する事を期待して作成していますが、なんらかの問題が発生しても作者は一切の責任を負いません。

BBSNoteのログファイルのバックアップをお願いします。消失しても責任をとれません。

## ダウンロード

[https://github.com/satopian/potiboard_plugin](https://github.com/satopian/potiboard_plugin)の緑色のボタンからzipファイルを入手して展開します。  
その中の`logconverter`フォルダの中にある `bbsnote2poti.php` を取り出して使います。 

## ログファイルの変換方法

BBSNoteのログファイルが入っている`data`フォルダを用意します。  
![image](https://user-images.githubusercontent.com/44894014/108525797-d4ff3500-7313-11eb-9ec7-8c39fa253cd0.png)

`bbsnote2poti.php`を図のように配置します。

## ローカルサーバで実行

webで実行するには高負荷です。また変換した画像やアニメファイルは移動ではなくコピーによって生成されるためサーバの容量を圧迫します。  
また、ログコンバータがwebに残っていると誰かが実行してしまうかもしれません。  
もし誰でも何度でも実行できる状態になっていたらサーバに大きな負担がかかります。  
そうならないようにパスワードを任意に設定できるようにしていますが、設定を忘れてサーバにアップロードしてしまうケースが発生するかもしれません。

[XAMPP](https://www.apachefriends.org/jp/index.html)というアプリを使えば簡単にPHP環境を作ることができます。  
ぜひローカル(たとえばWindowsのPCの中で)実行してください。  

## bbsnote2poti.php の設定を変更

エディタで`bbsnote2poti.php`を開くと、パスワードの設定欄があります。  
必ず変更してください。  
ローカルサーバでしか実行しないのであればそのままでもいいのかもしれませんがまちがってwebにあげてしまった時のための保険です。  

`data`ディレクトリ、ログファイルの頭文字や拡張子の設定項目があります。  
独自に変更していたり、BBSNoteのバージョンがv7とv8では頭文字や拡張子が異なっている時は、`data`ディレクトリに入っているログファイルの形式に合わせてください。  

`$relm=0; //relmのログを変換する時は 1`

BBSNoteではなく、relmというお絵かき掲示板のログファイルを変換する時は`1`です。

`//同じファイル名の画像が出力先にあるときは別名で保存
$save_at_synonym=0;// 1.する 0.しない`
デフォルトでは`0`。
`1.する`にすると、二度コンバートしてしまった時に、同じ画像のファイルが二重にできてしまいます。  
POTI-board形式に画像のファイル名を変換するときに、ログの投稿日時を読み込んでUNIXタイムに変換しています。  
しかし、秒までしか記録されていないので、同じ秒の投稿を処理できません。
そこで、もし同じ秒の投稿があったら秒以下の3桁に+1して別の画像として残せるようにしました。  
しかし、該当ケースはあまりないのかもしれません。  
そのため、デフォルトでは`0.しない`になっています。

### 変換実行 パスワードを入力して変換ボタンを押下

`bbsnote2poti.php`をローカルサーバで開きます。  
パスワードを入力して、`変換開始`を押します。

画面が切り替わり`変換開始`とでます。
完了すると、  
`完了しました`という表示がでます。

### 新規設置したPOTI-boardにログファイルを移動

potiフォルダにPOTI-board形式のログファイル一式ができます。
図のようなファイルがフォルダに入っていると思います。

しかし、そのファイルの取り扱いには注意が必要です。  
`img.log`に書き込んだ内容が入り、`tree.log`にスレッドのツリーの構造が入っています。  
POTI-boardのログファイルはこの2つしかないので、すでに運用中のPOTI-boardにこの2つのログファイルを上書きすると、これまでのすべての投稿が消えてなくなります。  
したがって、この変換したログファイルは、新しく設置したまだ何も投稿していないPOTI-boardにしか使えません。
BBSNoteやPOTI-boardのログファイルが消えてしまっても、何もできませんので、消えてしまうと困るものはバックアップしてください。  
よろしくお願いいたします。

### サポート
[Issues](https://github.com/satopian/potiboard_plugin/issues)または、[POTI改 設置サポート掲示板](https://pbbs.sakura.ne.jp/cgi/neosample/support/)をご利用ください。  

